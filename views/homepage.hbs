<video id="videoBG" poster="images/homepage.png" autoplay muted loop>
    <source src="videos/homepage.mp4" type="video/mp4">
</video>
<div id="container">
    <div id="textdiv">
        <h1>{{heading}}</h1>
        <p>{{info}}</p>
        <br>
        {{#if home}}
        <a style="color: white;" href="#" data-toggle="modal" data-target="#modalRegisterForm"><button
                class="btn btn-light" style="font-size: 18px;">{{cta}}</button></a>
        {{else}}
        <a style="color: white;" href="#"><button class="btn btn-light" style="font-size: 18px;">{{cta}}</button></a>
        {{/if}}
    </div>
</div>

<div class="modal fade" id="modalLoginForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="background-color: rgb(255, 199, 153)">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Sign in</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3">
                <div class="md-form mb-5">
                    <i class="fas fa-envelope prefix grey-text"></i>
                    <input type="email" id="email" class="form-control validate">
                    <label id="invalid-login-email" for="email">Your email</label>
                </div>

                <div class="md-form mb-4">
                    <i class="fas fa-lock prefix grey-text"></i>
                    <input type="password" id="password" class="form-control validate">
                    <label id="invalid-login-pass" for="password">Your password</label>
                </div>


                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn peach-gradient btn-rounded z-depth-1a waves-effect waves-light"
                        style="color: white;font-weight: 600;font-size: 15px;" onclick="validateLogin()">Login</button>
                </div>
                <p id="error" style="color: black; text-align: center;"></p>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalRegisterForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="background-color: rgb(255, 199, 153)">
            <div class="modal-header text-center">
                <h4 class="modal-title w-100 font-weight-bold">Sign up</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mx-3">
                <div class="md-form mb-5">
                    <i class="fas fa-user prefix grey-text"></i>
                    <input type="text" id="name" class="form-control validate">
                    <label id="invalid-name" for="name">Your name</label>
                </div>
                <div class="md-form mb-5">
                    <i class="fas fa-envelope prefix grey-text"></i>
                    <input type="email" id="r_email" class="form-control validate">
                    <label id="invalid-email" for="r_email">Your email</label>
                </div>

                <div class="md-form mb-4">
                    <i class="fas fa-lock prefix grey-text"></i>
                    <input type="password" id="r_password" class="form-control validate">
                    <label id="invalid-pass" for="r_password">Your password</label>
                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn peach-gradient" style="color: white;font-weight: 600;font-size: 15px;"
                        onclick="validateRegistration()">Sign up</button>
                </div>
                <p id="r_error" style="color: black; text-align: center;"></p>
            </div>

        </div>
    </div>
</div>

<script>
    function validateRegistration() {
        if ($("#name").val() == '') {
            $("#invalid-name").css("color", "red")
            $("#invalid-name").text("Please enter a value")
            $("#name").focus();
            return false;
        }
        else ($("#invalid-name").css("color", "green"))
        var email = $("#r_email").val();
        atpos = email.indexOf("@");
        dotpos = email.lastIndexOf(".");
        if (atpos < 1 || (dotpos - atpos < 2)) {
            $("#invalid-email").css("color", "red")
            $("#invalid-email").text("Please enter a valid email");
            $("#r_email").focus();
            return false;
        }
        else ($("#invalid-email").css("color", "green"))
        var passReg = new RegExp('[0-9]');
        if (!(passReg.test($("#r_password").val())) || !($("#r_password").val().length > 7)) {
            $("#invalid-pass").css("color", "red")
            $("#invalid-pass").text("Minimum 8 characters with at least 1 digit");
            $("#r_password").focus();
            return false;
        }
        else ($("#invalid-pass").css("color", "green"))
        register();
    }

    function validateLogin() {
        var email = $("#email").val();
        atpos = email.indexOf("@");
        dotpos = email.lastIndexOf(".");
        if (atpos < 1 || (dotpos - atpos < 2)) {
            $("#invalid-login-email").css("color", "red")
            $("#invalid-login-email").text("Please enter a valid email");
            $("#email").focus();
            return false;
        }
        else ($("#invalid-login-email").css("color", "green"))
        if (!($("#password").val().length > 7)) {
            $("#invalid-login-pass").css("color", "red")
            $("#invalid-login-pass").text("Please enter your password of min. 8 characters");
            $("#password").focus();
            return false;
        }
        else ($("#invalid-login-pass").css("color", "green"))
        signIn();
    }

    function signIn() {
        var email = document.getElementById("email").value
        var password = document.getElementById("password").value
        var xmlHttpRequest = new XMLHttpRequest()
        xmlHttpRequest.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    document.cookie = "authorization=" + this.getResponseHeader("authorization")
                    console.log("Signin successful!")
                    window.location = "/feed"
                }
                else {
                    document.getElementById("error").innerText = JSON.parse(this.responseText).msg
                }
            }
        }
        xmlHttpRequest.open("POST", "/users/signin", true)
        console.log("Request Made");
        xmlHttpRequest.setRequestHeader("Content-Type", "application/json")
        xmlHttpRequest.send(JSON.stringify({ email: email, password: password }))
    }

    function register() {
        var name = document.getElementById("name").value
        var email = document.getElementById("r_email").value
        var password = document.getElementById("r_password").value
        var xmlHttpRequest = new XMLHttpRequest()
        xmlHttpRequest.onreadystatechange = function () {
            if (this.readyState === 4) {
                if (this.status === 200) {
                    document.cookie = "authorization=" + this.getResponseHeader("authorization")
                    window.location = "/verificationEmail"
                }
                else {
                    document.getElementById("r_error").innerText = JSON.parse(this.responseText).msg
                }
            }
        }
        xmlHttpRequest.open("POST", "/users/signup", true)
        xmlHttpRequest.setRequestHeader("Content-Type", "application/json")
        xmlHttpRequest.send(JSON.stringify({ name: name, email: email, password: password }))
    }
</script>