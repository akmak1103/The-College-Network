<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Welcome to College Network</title>
	<link rel="stylesheet" href="/stylesheets/login.css">
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js"
		integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
		crossorigin="anonymous"></script>

</head>

<body>
	<div class="login-reg-panel">
		<div class="login-info-box">
			<h2>Have an account?</h2>
			<br>
			<br>
			<label id="label-register" for="log-reg-show">Login</label>
			<input type="radio" name="active-log-panel" id="log-reg-show" checked="checked">
		</div>

		<div class="register-info-box">
			<h2>Don't have an account?</h2>
			<br>
			<br>
			<label id="label-login" for="log-login-show">Register</label>
			<input type="radio" name="active-log-panel" id="log-login-show">
		</div>

		<div class="white-panel">
			<div class="login-show">
				<h2>LOGIN</h2>
				<p class="text-center" style="color: green;">{{msg}}</p>
				<input type="text" placeholder="abc@xyz.com" required="required" id="email">
				<input type="password" placeholder="Password" required="required" id="password">
				<button class="btn btn-outline-danger" onclick="signIn()">Sign in</button>
				<p id="error" class="text-center" style="color: red;"></p>
				<a href="">Forgot password?</a>
			</div>
			<div class="register-show">
				<h2>REGISTER</h2>
				<input type="text" placeholder="Name" required="required" id="name">
				<input type="text" placeholder="Email" required="required" id="r_email">
				<input type="password" placeholder="Password" required="required" id="r_password">
				<button class="btn btn-outline-danger" onclick="register()">Register</button>
				<p id="r_error" class="text-center"></p>
			</div>
		</div>
	</div>

	<script>
		$(document).ready(function () {
			$('.login-info-box').fadeOut();
			$('.login-show').addClass('show-log-panel');
		});

		$('.login-reg-panel input[type="radio"]').on('change', function () {
			if ($('#log-login-show').is(':checked')) {
				$('.register-info-box').fadeOut();
				$('.login-info-box').fadeIn();

				$('.white-panel').addClass('right-log');
				$('.register-show').addClass('show-log-panel');
				$('.login-show').removeClass('show-log-panel');
			} else if ($('#log-reg-show').is(':checked')) {
				$('.register-info-box').fadeIn();
				$('.login-info-box').fadeOut();

				$('.white-panel').removeClass('right-log');

				$('.login-show').addClass('show-log-panel');
				$('.register-show').removeClass('show-log-panel');
			}
		});

		function signIn() {
			var email = document.getElementById("email").value
			var password = document.getElementById("password").value
			var xmlHttpRequest = new XMLHttpRequest()
			xmlHttpRequest.onreadystatechange = function () {
				if (this.readyState === 4) {
					if (this.status === 200) {
						document.cookie = "authorization=" + this.getResponseHeader("authorization")
						console.log("Signin successful!")
						window.location = "/"
					}
					else {
						document.getElementById("error").innerText = JSON.parse(this.responseText).msg
					}
				}
			}
			xmlHttpRequest.open("POST", "/users/signin", true)
			console.log("Request Made");
			xmlHttpRequest.setRequestHeader("Content-Type", "application/json")
			xmlHttpRequest.send(JSON.stringify({ email: email, password: password }))
		}

		function register() {
			var name = document.getElementById("name").value
			var email = document.getElementById("r_email").value
			var password = document.getElementById("r_password").value
			var xmlHttpRequest = new XMLHttpRequest()
			xmlHttpRequest.onreadystatechange = function () {
				if (this.readyState === 4) {
					if (this.status === 200) {
						console.log("Signup successful")
						document.getElementById("r_error").style = "color:green";
						document.getElementById("r_error").innerText = JSON.parse(this.responseText).msg
					}
					else {
						document.getElementById("r_error").style = "color:red";
						document.getElementById("r_error").innerText = JSON.parse(this.responseText).msg
					}
				}
			}
			xmlHttpRequest.open("POST", "/users/signup", true)
			xmlHttpRequest.setRequestHeader("Content-Type", "application/json")
			xmlHttpRequest.send(JSON.stringify({ name: name, email: email, password: password }))
		}
	</script>
</body>

</html>